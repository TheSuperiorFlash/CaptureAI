<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="header">
        <div class="header-left">
            <img src="icons/icon128.png" alt="CaptureAI" class="header-logo">
            <span class="header-title">CaptureAI</span>
        </div>
        <div class="header-right">
            <button id="header-ui-toggle" class="header-ui-toggle">Show UI</button>
        </div>
    </div>
    
    <div class="content">
        <!-- Main View -->
        <div id="main-view">
            <!-- Response Section -->
            <div id="response-section" class="response-section">
                <div class="response-title">Response:</div>
                <div id="response-content" class="response-content empty"></div>
            </div>

        <!-- Status Section -->
        <div id="status-section" class="section hidden">
            <div id="status-message" class="status"></div>
        </div>

        <!-- Migration Notice Section -->
        <div id="migration-notice" class="section hidden migration-notice">
            <div class="migration-notice-title">Important Update</div>
            <div id="migration-notice-text" class="migration-notice-text"></div>
        </div>

        <!-- License Key Section -->
        <div id="license-key-section" class="section hidden">
            <div class="activation-header">
                <h3>Activate CaptureAI</h3>
                <p>
                    Get your free key at
                    <a href="https://captureai.dev/activate" target="_blank" class="activation-link">
                        activate page
                    </a>
                </p>
            </div>

            <div class="input-group">
                <label>License Key</label>
                <input type="text" id="license-key-input" placeholder="XXXX-XXXX-XXXX-XXXX-XXXX" class="license-key-input">
            </div>
            <button id="activate-btn" class="button button-primary">Activate</button>
        </div>

        <!-- Main Controls Section (for activated users) -->
        <div id="main-controls" class="section hidden">
            <!-- Usage Stats -->
            <div id="usage-stats" class="usage-stats">
                <div class="usage-stats-label">Usage</div>
                <div id="usage-content"></div>
            </div>

            <button id="capture-btn" class="button button-primary button-with-icon">
                <img src="icons/camera.png" alt="Camera" class="button-icon">
                Capture a Question
            </button>
            <button id="quick-capture-btn" class="button button-secondary">Quick Capture</button>
        </div>

        <!-- Help Section -->
        <div id="help-section" class="help-section">
            <div class="help-toggle" id="help-toggle">
                <span>Help</span>
                <span class="help-arrow" id="help-arrow">â–¶</span>
            </div>
            <div class="help-content" id="help-content">
                <div class="help-category">Keybinds</div>
                <div class="help-item"><span class="help-shortcut">Ctrl+Shift+E</span> Toggle UI panel</div>
                <div class="help-item"><span class="help-shortcut">Ctrl+Shift+X</span> Start area capture</div>
                <div class="help-item"><span class="help-shortcut">Ctrl+Shift+F</span> Quick capture</div>
                <div class="help-category">Stealth Mode</div>
                <div class="help-item">When UI is hidden, question capture works invisibly with no overlay or selection box.</div>

                <!-- User Info (moved from main-controls) -->
                <div class="help-item user-info-container">
                    <div id="user-info" class="user-info">
                        <div class="user-info-header">
                            <div class="user-info-label">Logged in as:</div>
                            <button id="logout-btn">Logout</button>
                        </div>
                        <div id="user-email"></div>
                        <div class="user-info-footer">
                            <div id="user-tier"></div>
                            <button id="upgrade-btn" class="hidden">Upgrade to Pro</button>
                        </div>
                    </div>
                </div>

                <!-- Settings Button -->
                <div class="help-item settings-button-container">
                    <button id="settings-btn">Settings</button>
                </div>
            </div>
        </div>
        </div>

        <!-- Settings View -->
        <div id="settings-view" class="hidden">
            <!-- Settings Section Header -->
            <div class="settings-header">
                <button id="back-to-main-btn">
                    <img src="icons/back-arrow.png" alt="Back" class="back-arrow-icon">
                </button>
                <h2>Settings</h2>
            </div>

            <div class="settings-section">
                <div id="privacy-guard-item" class="settings-card">
                    <div class="settings-item-header">
                        <div>
                            <div class="settings-item-title">PrivacyGuard</div>
                            <div class="settings-item-description">
                                Prevents websites from detecting extension usage and tab switching
                            </div>
                        </div>
                        <div class="toggle-switch" id="privacy-guard-toggle">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>

                    <div class="domain-blacklist-section">
                        <div class="domain-blacklist-label">
                            Disable on specific websites:
                        </div>
                        <div class="domain-input-group">
                            <input type="text" id="domain-input" placeholder="example.com">
                            <button id="add-domain-btn">Add</button>
                        </div>
                        <div id="domain-list">
                            <div class="domain-list-empty">No domains in blacklist</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <div id="reasoning-level-item" class="settings-card">
                    <div class="reasoning-level-title">Reasoning Level</div>
                    <div class="reasoning-level-description">
                        Control how deeply the AI analyzes questions. Higher levels provide better answers but increase response time
                    </div>
                    <div class="reasoning-toggle-container reasoning-toggle-wrapper">
                        <input type="range" id="settings-reasoning-slider" min="0" max="2" value="1" step="1">
                        <div class="reasoning-toggle-track" id="settings-reasoning-toggle-track">
                            <div class="reasoning-toggle-progress" id="settings-reasoning-toggle-progress"></div>
                            <div class="reasoning-toggle-slider" id="settings-reasoning-toggle-slider"></div>
                            <span class="reasoning-label reasoning-label-low">Low</span>
                            <span class="reasoning-label reasoning-label-medium">Medium</span>
                            <span class="reasoning-label reasoning-label-high">High</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-card">
                    <div class="settings-item-header">
                        <div>
                            <div class="settings-item-title">Disable OCR Extraction</div>
                            <div class="settings-item-description">
                                Send image data instead of extracting text (not recommended)
                            </div>
                        </div>
                        <div class="toggle-switch" id="ocr-toggle">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="modules/auth-service.js"></script>
    <script src="modules/migration.js"></script>
    <script src="popup.js"></script>
</body>
</html>
